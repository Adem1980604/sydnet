<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="/vpapir.css"> 
  <title><%= info.navn %> - Detaljer</title>

  <!-- Import af Chart.js bibliotek -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <div class="content-container">
    <!-- Detaljeboksen -->
    <div class="card">
      <h1>Detaljer for <%= info.navn %> (<%= info.symbol %>)</h1>
      <ul>
        <li><strong>Type:</strong> <%= info.type %></li>
        <li><strong>Seneste pris:</strong> <%= info.seneste_pris %> DKK</li>
        <li><strong>Markedsværdi:</strong> <%= info.markedsvaerdi %></li>
        <li><strong>Børs:</strong> <%= info.bors %></li>
      </ul>
      <a href="/dashboard">← Tilbage til dashboard</a>
    </div>

    <!-- Grafen -->
    <div class="chart-container">
      <canvas id="aktieChart"></canvas>
    </div>
  </div>

  <!-- ******************* CHARTS BEGYNDER HER ******************* -->
  <script>
 
   // Hent symbol direkte fra EJS
   const symbol = "<%= info.symbol %>";


async function hentOgVisGraf(symbol) {
  // Hent kursdata fra din egen backend
  const response = await fetch(`/aktiesoeg/hentaktiekurs/${symbol}`);
  const data = await response.json();

  const timeSeries = data["Weekly Time Series"];
  const labels = [];
  const priser = [];

  // Sortér tidspunkterne fra ældst til nyest
  const tidspunkter = Object.keys(timeSeries).sort();

  for (let i = 0; i < tidspunkter.length; i++) {
    const tid = tidspunkter[i];
    labels.push(tid);
    priser.push(parseFloat(timeSeries[tid]["4. close"]));
  }


      // Initialiser grafen med Chart.js
      new Chart(document.getElementById('aktieChart').getContext('2d'), {
  type: 'line',
  data: {
    labels: labels,
    datasets: [{
      label: `${symbol} Pris (USD)`,
      data: priser,
      borderColor: '#7c4dff',
      backgroundColor: 'rgba(124, 77, 255, 0.2)',
      pointBackgroundColor: '#7c4dff',
      pointBorderColor: '#ffffff',
      pointRadius: 5,
      pointHoverRadius: 7,
      fill: true,
      tension: 0.4,
      borderWidth: 2
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        labels: {
          color: '#ffffff'
        }
      }
    },
    scales: {
      x: {
        ticks: {
          color: '#ffffff'
        },
        grid: {
          color: 'rgba(255, 255, 255, 0.1)'
        },
        title: {
          display: true,
          text: "Tidspunkt",
          color: '#ffffff'
        }
      },
      y: {
        ticks: {
          color: '#ffffff'
        },
        grid: {
          color: 'rgba(255, 255, 255, 0.1)'
        },
        title: {
          display: true,
          text: "Pris (USD)",
          color: '#ffffff'
        }
      }
    }
  }
});
};
// Kalder funktionen
hentOgVisGraf(symbol);



  </script>

</body>
</html>
